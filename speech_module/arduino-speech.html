<!DOCTYPE html>
<meta charset="utf-8">

<!-- Start HTML Code -->

<title>SKYNET R&D</title>

<h1 align="center">SKYNET SYSTEMS : T-1 DEMO</h1>

<p>
    <div align="center">
        Click Arnold to start!
    </div>
</p>

<p>
<div align="center">
  <button id="start_button" onclick="startButton(event)">
      <img id="start_img" src="images/arnold-ready.jpg" alt="Start" height="180" width="200"></button>
</div>
</p>

<div id="errors" align="center">
    <font color="red"><span id="errorCode"></span></font>
<div>

<p>
<div id="results" align="center">
    <span id="final_span" class="final"></span>
</div>
</p>

<!-- End HTML Code -->

<!-- Start JavaScript Code -->

<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>

<script>

    var socket = io();
    var recognizing = false;
    var final_transcript = '';

    if (('webkitSpeechRecognition' in window)) {

        var recognition = new webkitSpeechRecognition();

        // Are we performing continuous recognition or not?
        // If this is false, we need to trigger a restart at onend
        recognition.continuous = false;

        // Do we want interim results or not (true means yes)
        recognition.interimResults = false;

        // On start of Voice Recognition attempt
        recognition.onstart = function() {
            console.log("Speech recognition started.");

            recognizing = true;
            errorCode.innerHTML = '';
            start_img.src = 'images/arnold-record.gif';
        }

        // Processing of returned results
        recognition.onresult = function(event) {

            console.log("Speech recognition returned.", event);

            for (var i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    final_transcript += event.results[i][0].transcript + '<br>';
                    socket.emit('command', event.results[i][0].transcript);
                }
            }
            final_span.innerHTML = final_transcript;
        }

        // Handling Errors
        recognition.onerror = function(event) {

            console.log("Error", event);

            errorCode.innerHTML = "Error Code: " + event.error;
            recognizing = false;
            start_img.src = 'images/arnold-error.jpg';
        }

        // Handling end of Voice Recognition
        recognition.onend = function() {

            console.log("Speech recognition ended");

            recognizing = false;
            if (errorCode.innerHTML == ''){
                start_img.src = 'images/arnold-ready.jpg';
                recognition.start();
            }
        }

    }else{
        errorCode.innerHTML = "Speech recognition is not available via this device or browser.";
        recognizing = false;
        start_img.src = 'images/arnold-error.jpg';
    }

    function startButton(event) {
      if (recognizing) {
        recognition.stop();
        return;
      }
      final_transcript = '';
      recognition.lang = 'en-GB'
      recognition.start();
      ignore_onend = false;
    }

</script>

<!-- End JavaScript Code -->
